!function n(t,e,r){function o(u,a){if(!e[u]){if(!t[u]){var l="function"==typeof require&&require;if(!a&&l)return l(u,!0);if(i)return i(u,!0);var s=new Error("Cannot find module '"+u+"'");throw s.code="MODULE_NOT_FOUND",s}var c=e[u]={exports:{}};t[u][0].call(c.exports,function(n){var e=t[u][1][n];return o(e||n)},c,c.exports,n,t,e,r)}return e[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(n,t,e){"use strict";function r(n){if(null==n)throw new TypeError("Cannot destructure undefined")}function o(n){return Array.isArray(n)?n:Array.from(n)}function i(n){if(Array.isArray(n)){for(var t=0,e=Array(n.length);t<n.length;t++)e[t]=n[t];return e}return Array.from(n)}function u(){m.splice(0,m.length);for(var n=d-1;n>=0;n--){var t=localStorage.getItem("research-session-"+n+"-meta");if(t){var e=JSON.parse(t);e.actions>0&&m.push(e)}}}function a(n){localStorage.setItem("research-session-"+d+"-meta",JSON.stringify(n))}function l(n){E.actions=n.length,localStorage.setItem("research-session-"+d,JSON.stringify(n)),a(E)}function s(n,t){return function(e){for(var r=arguments.length,o=Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];return e.log.push([n].concat(i((0,p.filter)(o,function(n){return!(n instanceof Event)})))),S(e.log),t.apply(void 0,[e].concat(o))}}function c(n){for(var t in n)n[t]=s(t,n[t]);return n}function f(){if(window.getSelection)return window.getSelection().toString()}function g(n){var t=prompt("Enter file name","research.session");if(t){var e=document.createElement("a"),r=new Blob([JSON.stringify(n)],{type:"text/json"});document.body.appendChild(e),e.href=URL.createObjectURL(r),e.download=t||"research.session",e.click(),e.remove()}}function h(n){var t=document.createElement("input");t.type="file",t.addEventListener("change",function(t){var e=t.target.files[0],r=new FileReader;r.addEventListener("load",function(t){var e=r.result;n(O.LOAD_LOG)(JSON.parse(e))}),r.readAsText(e)}),t.click()}var v=n("preact-cycle"),p=n("lodash"),d=function(){var n=localStorage.getItem("research-last-session-id")||"-1";try{return parseInt(n)}catch(n){return-1}return-1}()+1,E={sessionId:d,start:(new Date).getTime(),actions:0};localStorage.setItem("research-last-session-id",d),a(E);var m=[];u(),window.addEventListener("close",function(){return l(K.log)});var S=(0,p.throttle)(l,1e3),T=void 0,y=function(n){return n.target.previousElementSibling.value},O=function(n){return c(n(function(n){for(var t=arguments.length,e=Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return T(n).apply(void 0,e)}))}(function(n){return{ADD_UNIT:function(n,t){return""!==t&&n.units.push(t),n},CHECK_SELECTED_TEXT:function(t){var e=f().trim();return void 0===e||e.match(/^\s*$/)||e===(t.selections.length>0?t.selections[0]:"")?t:n(I,e)},INSERT_SELECTED_TEXT:function(n,t){return n.selections.unshift(t),n},HIGHLIGHT_TAG:function(n,t){return n.highlightedTag=t,console.log("highlighted",t),n},LOAD_LOG:function(t,e){e.forEach(function(t){var e=o(t),r=e[0],u=e.slice(1);n.apply(void 0,[O[r]].concat(i(u)))})},LOAD_SESSION:function(t,e){var r=localStorage.getItem("research-session-"+e.sessionId);return r&&n(O.LOAD_LOG,JSON.parse(r)),t},REMOVE_SELECTION:function(n,t){var e=n.selections.indexOf(t);return e>=0&&n.selections.splice(e,1),n},REMOVE_SESSION:function(n,t){return localStorage.removeItem("research-session-"+t),localStorage.removeItem("research-session-"+t+"-meta"),u(),n},SET_TAG:function(n,t,e){return(0,p.find)(n.tags,{tag:t.tag,selection:t.selection}).tag=e,n},SET_NOTES:function(n,t,e){var r=(0,p.find)(n.tags,{tag:t.tag,selection:t.selection});return r&&(r.notes=e),n},TAG_SELECTION:function(n,t,e){return(0,p.find)(n.tags,{tag:e,selection:t})||n.tags.push({selection:t,tag:e,notes:""}),n},TOGGLE_LOG_DISPLAY:function(n){return n.logDisplay="full"===n.logDisplay?"summary":"full",n}}}),_=O.ADD_UNIT,L=O.CHECK_SELECTED_TEXT,I=O.INSERT_SELECTED_TEXT,A=O.HIGHLIGHT_TAG,N=O.LOAD_SESSION,C=O.REMOVE_SELECTION,D=O.REMOVE_SESSION,w=O.SET_TAG,G=O.SET_NOTES,b=O.TAG_SELECTION,R=O.TOGGLE_LOG_DISPLAY,k=function(n,t){var e=t.previousSessions,o=t.mutation;return r(n),(0,v.h)("previous-sessions",null,(0,v.h)("span",null,"Saved Sessions"),e.map(function(n){return(0,v.h)("session",{onClick:o(N,n)},"(",n.actions,") ",new Date(n.start).toString()," ",(0,v.h)("button",{onClick:function(t){if(t.stopPropagation(),confirm("Are you sure you want to remove this session?"))return o(D)(n.sessionId)}},"Remove"))}))},x=function(n,t){var e=t.units,o=t.mutation;return r(n),(0,v.h)("units-display",{onMouseUp:o(L)},e.map(function(n){return(0,v.h)(H,{unit:n})}))},H=function(n){var t=n.unit;return(0,v.h)("unit",null,t)},J=function(n,t){var e=n.selection,r=t.tags,o=t.mutation;return(0,v.h)("unit-annotator",null,(0,v.h)("remove-button",{onClick:o(C,e),title:"Remove"},"Remove Selection"),(0,v.h)("selection",null,e),(0,v.h)("inputs",null,(0,v.h)("input",{type:"text",placeholder:"add a tag...",autoFocus:!0}),(0,v.h)("button",{onClick:function(n){return function(t){n(y(t)),t.target.previousElementSibling.value="",t.target.previousElementSibling.focus()}}(o(b,e))},"Tag")),(0,v.h)("unit-tags",null,Object.values((0,p.groupBy)(r,"selection")[e]||[]).map(function(n){return(0,v.h)(U,{tag:n})})))},U=function(n,t){var e=n.tag,r=t.mutation;return(0,v.h)("tag-editor",null,(0,v.h)("input",{type:"text",value:e.tag,onBlur:function(n){return function(t){return n(t.target.value)}}(r(w,e))}),(0,v.h)("textarea",{placeholder:"notes",value:e.notes,onBlur:function(n){return function(t){return n(t.target.value)}}(r(G,e))}))},F=function(n,t){var e=t.mutation;return r(n),(0,v.h)("input-area",null,(0,v.h)("textarea",{autoFocus:!0}),(0,v.h)("button",{onClick:function(n){return function(t){n(y(t)),t.target.previousElementSibling.value="",t.target.previousElementSibling.focus()}}(e(_))},"Add"))},M=function(n){var t=n.selections;return(0,v.h)("selections",null,"Active Selections:",t.map(function(n){return(0,v.h)(J,{selection:n})}))},B=function(n,t){var e=n.tags;return r(t),(0,v.h)("tags",null,(0,v.h)("span",null,"Tags:"),Object.values((0,p.mapValues)((0,p.groupBy)(e,"tag"),function(n,t){return(0,v.h)(V,{tag:t,selections:n})})))},V=function(n,t){var e=n.tag,r=n.selections,o=t.highlightedTag,i=t.mutation;return(0,v.h)("tag",{className:{highlighted:e===o},onClick:i(A,e)},(0,v.h)("name",null,e),(0,v.h)("count",null,"(",r.length,")"))},j=function(n,t){var e=n.tag,r=t.tags;return(0,v.h)("tag-notes",null,(0,v.h)("span",null,"Tag Notes:"),(0,p.filter)(r,function(n){var t=n.tag;return e===t}).map(function(n){return(0,v.h)("detail",null,(0,v.h)("selection",null,n.selection)," ",(0,v.h)("notes",null,n.notes))}))},q=function(n,t){var e=t.log,o=t.logDisplay,i=t.mutation;return r(n),(0,v.h)("log",null,(0,v.h)("span",{onClick:i(R)},"Action Log:"),"full"===o?(0,v.h)(X,{log:e}):(0,v.h)(P,{log:e}))},X=function(n){var t=n.log;return(0,v.h)("full-log",null,t.map(function(n,t){return(0,v.h)("entry",null,t,": ",JSON.stringify(n))}))},P=function(n,t){var e=n.log,r=t.mutation;return(0,v.h)("summary",null,e.length," items",(0,v.h)("button",{onClick:function(){return g(e)}},"Save File"),(0,v.h)("button",{onClick:function(){return h(r)}},"Load File"))},K={selections:[],tags:[],units:[],log:[],previousSessions:m};(0,v.render)(function(n,t){var e=n.highlightedTag,r=n.previousSessions,o=n.selections,i=n.tags,u=t.mutation;return(0,v.h)("www-prototype",null,T=u,r.length>0?(0,v.h)(k,null):void 0,(0,v.h)("left",null,(0,v.h)(x,null),(0,v.h)(F,null)),(0,v.h)("right",null,(0,v.h)("side-by-side",null,o.length>0?(0,v.h)(M,{selections:o}):void 0,"Â ",i.length>0?(0,v.h)(B,{tags:i}):void 0,e?(0,v.h)(j,{tag:e}):void 0),(0,v.h)(q,null)))},K,document.body),console.dir(K)},{lodash:"lodash","preact-cycle":"preact-cycle"}]},{},[1]);